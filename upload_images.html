<!DOCTYPE html>
<html>
<head>
    <title>Firebase Web Basics</title>

    <link href="https://fonts.googleapis.com/css?family=Raleway:300,400,500,700" rel="stylesheet">

    <script src="https://use.fontawesome.com/939e9dd52c.js"></script>

    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>

<div class="mainDiv" align="right">
    <h1 align="left">Firebase File Upload</h1>
    <progress id="uploader" value="0" max="100">0%</progress>
    <input type="file" accept="image/*" capture="camera" id="fileButton" value="upload" multiple=""/>

</div>



<script src="https://www.gstatic.com/firebasejs/5.0.4/firebase.js"></script>
<script>
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyCLG0Uqpl79OD1NkP8txdA_fFR2QHscK4w",
        authDomain: "opal-1526306570324.firebaseapp.com",
        databaseURL: "https://opal-1526306570324.firebaseio.com",
        projectId: "opal-1526306570324",
        storageBucket: "opal-1526306570324.appspot.com",
        messagingSenderId: "809694766352"
    };
    firebase.initializeApp(config);
    //-------------------------------------

    var database = firebase.database();
    function uploadNewPhoto(imageUrl, album) {
        var refAlbum = database.ref('gallery/' + album);
        refAlbum.push(imageUrl).then(function onSuccess(res) {
            console.log(res)
        }).catch(function onError(err) {
            console.log(err)
        });
    }


    var fileButton = document.getElementById('fileButton');

    fileButton.addEventListener('change', function(e){
        for(var i = 0; i < fileButton.files.length; i++) {

            var file = e.target.files[i];
            var storageRef = firebase.storage().ref('Start_2017/' + file.name);
            var task = storageRef.put(file);

            task.on('state_changed', function (snapshot) {
                // Observe state change events such as progress, pause, and resume
                // Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded
                var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                console.log('Upload is ' + progress + '% done');
                switch (snapshot.state) {
                    case firebase.storage.TaskState.PAUSED: // or 'paused'
                        console.log('Upload is paused');
                        break;
                    case firebase.storage.TaskState.RUNNING: // or 'running'
                        console.log('Upload is running');
                        break;
                }
            }, function (error) {
                // Handle unsuccessful uploads
            }, function () {
                // Handle successful uploads on complete
                // For instance, get the download URL: https://firebasestorage.googleapis.com/...
                task.snapshot.ref.getDownloadURL().then(function (downloadURL) {
                    console.log('File available at', downloadURL);
                    uploadNewPhoto(downloadURL, "Start_2017");
                });
            });
        }
    });

</script>

</body>
</html>